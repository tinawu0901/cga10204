<!doctype html>
<html lang="en">

<head>
  <title>Family Rent || 會員註冊</title>
  <link rel="icon" href="icon/pngkey.com-gps-icon-png-5131691.png" type="image/x-icon" />
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700;900&display=swap" rel="stylesheet">
  <script src="https://kit.fontawesome.com/1d9dcf12aa.js" crossorigin="anonymous"></script>
  <link rel="stylesheet" href="../../resources/css/style.css">
  <link rel="stylesheet" href="../../resources/css/bootstrap.min.css">
  <script src="https://code.jquery.com/jquery-3.6.0.js" integrity="sha256-H+K7U5CnXl1h5ywQfKtSj8PCmoN9aaq30gDh27Xc0jk="
    crossorigin="anonymous"></script>

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Koulen&family=Teko:wght@300&display=swap');
  </style>
  <style>
    body {
      font-family: 微軟正黑體 !important;
      font-weight: bold;
    }

    .err::placeholder {
      color: red;

    }

    .err {
      border: 2px solid red;
    }

    .ok {
      border: 2px solid green;
    }
  </style>
  <style>
    div.SignUp {
      background-color: rgba(216, 226, 218, 0.4);
      border-radius: 2%;
    }

    .button3 {
      border: 0;
      background-color: #003C9D;
      color: #fff;
      border-radius: 10px;
      cursor: pointer;
      font-weight: bold;
    }

    .btn-link {
      font-weight: bold;
      color: navy;
    }
  </style>
</head>

<body>

  <!-- 背景圖輸入這行div!!!!-->
  <div class="hero" style="background-image: url('../../resources/img/hero_1_a.jpg');">

    <div class="SignUp"
      style="width:35%; margin: 0 auto; position:fixed; top:50%;left:50%;margin-left:calc(-35% / 2);margin-top:-321.835px;">
      <h1 class="mb-3">會員註冊<i class="fa-solid fa-address-card"></i></h1>
      <div class="needs-validation" style="display: flex;flex-wrap: wrap;justify-content: space-between;">
        <!-- 姓名!!!! -->
        <div class="name1" style="width:45%;">
          <div class="mb-2">
            <label for="firstName">姓名:</label>
            <input type="text" class="form-control" id="firstName" placeholder="請輸入姓名" value="" required>
          </div>
        </div>
        <!-- 身分證字號!!! -->
        <div class="ID1" style="width:45%;">
          <div class="mb-3">
            <label for="ID2">身分證字號:</label>
            <input type="text" class="form-control" id="IDCARD" placeholder="請輸入身分證號碼" value="" required>
          </div>
        </div>
        <!-- 生日 -->
        <div class="BD1" style="width:45% ;">
          <div class="mb-4">
            <label for="Birthday">生日:</label>
            <input type="date" class="form-control" id="Birthday" placeholder="" value="" required>
          </div>
        </div>

        <!-- 性別 -->
        <div class="gender1" style="width:45%;">
          <div class="mb-4" style="height:79px;">
            <label for="ID2">性別:</label>
            <select class="form-contro1" id="gender" style="width: 100%;height: 70%;/* display: block; */">
              <option class="grndert">請選擇</option>
              <option value="0">女</option>
              <option value="1">男</option>
              <option value="2">其他</option>
            </select>
          </div>
        </div>

        <!-- 您的設定密碼 -->
        <div class="password1" style="width:45%;">
          <div class="mb-4">
            <label for="password">您的設定密碼:</label>
            <input type="password" class="form-control" id="password" placeholder="請輸入密碼" value="" required>
          </div>
        </div>
        <!-- 再次確認密碼 -->
        <div class="password2" style="width:45%;">
          <div class="mb-4">
            <label for="password2">再次確認密碼:</label>
            <input type="password" class="form-control" id="ConfirmPassword" placeholder="請再次確認密碼" value="" required>
          </div>
        </div>
        <!-- 信箱 -->
        <div class="email1" style="width:45%;">
          <div class="mb-4">
            <label for="email">電子信箱:</label>
            <input type="text" class="form-control" id="email" placeholder="請填寫E-mail" value="" required>
          </div>
        </div>
        <!-- 手機號碼 -->
        <div class="phone1" style="width:45%;">
          <div class="mb-4">
            <label for="phone">行動電話:</label>
            <input type="text" class="form-control" id="phone" placeholder="請輸入手機號碼" value="" required>
          </div>
        </div>
        <!-- 通訊地址 -->
        <div class="city1" style="width:120%;">
          <label for="city">通訊地址<div id="twzipcode"></div>
          </label>

          <input type="text" class="form-control" id="street" name="street" maxlength="30" placeholder="詳細地址"
            style="width:100% ;">
        </div>
        <!-- 閱讀同意書 -->
        <div class="consent1" style="margin-left: 23%">
          <label for="consent"> <input type="checkbox" id="consent">我已閱讀並同意<button type="button"
              class="btn btn-link shadow-none" data-bs-toggle="modal" data-bs-target="#exampleModal"
              style="border: none;">「會員條款」與「隱私權條款」</button> </label>
          <!-- 註冊button -->

        </div>
        <div class="button1" style="width:100%;">
          <button class="button3" style="width:100%;height:60px;">確認送出</button>
        </div>
      </div>
    </div>

    <div class="modal fade" id="exampleModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="exampleModalLabel">注意事項</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            一. 承租人須年滿20歲， 且持有中華民國身分證(外籍人士應持有護照) 及監理單位認可之汽車駕照，並以信用卡支付款項。<br>
            二. 假日定義：週五至週日、國定假日及其前一日、連續假日及其前一日。平日定義：假日以外均屬平日。<br>
            三. 為保護您的權益，承租車輛發生碰撞或失竊時，請保持現場，並立即報警處理，切勿與對方私下和解，並和本公司聯絡，否則承租人須負賠償責任，並無法享租賃契約書保險理賠保障。<br>
            四. 門市營業時間為8:00~20:00，請於營業時間內至門市／櫃台現場辦理取／還車手續。<br>
            五. 承租人逾時未還車或續租時，未還車前雙方權利義務仍以租賃契約書約定為準。<br>
            六. 逾時費如下：
            【客車】：
            客車日租金為24小時制，逾1小時以上者，每小時加收日租金十分之一，逾6小時以上者，以一日租金計算。
            承租人如欲續租，請在約定還時間之前通知本公司(本公司保留是否續租之權利)。<br>
            七.其餘未盡事宜，以汽車出租單（客車租賃契約書、貨車租賃契約書）為準。
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          </div>
        </div>
      </div>
    </div>
    <script src="../../resources/js/bootstrap.bundle.min.js"></script>
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <!-- 地址選取器 -->
    <script src="../../resources/js/jquery.twzipcode.js"></script>
    <script>
      
    let today = new Date();
    let yyyy = today.getFullYear();
    let MM = today.getMonth() + 1;
    let dd = today.getDate();
    MM = checkTime(MM);
    dd = checkTime(dd);
    let max = yyyy + '-' + MM + '-' + dd;
    $('#Birthday').attr('max', max);

    function checkTime(i) {
        if (i < 10) {
            i = '0' + i
        }
        return i
    }

      //地址選取器 
      $('#twzipcode').twzipcode({
        'zipcodeSel': '106',
        'countySel': '臺北市',
        'districtSel': '大安區',
        zipcodeIntoDistrict: true
      });

      $('.button3').click(function () {
        if (($('.ok').length) === 9 && $('#consent').prop('checked') === true) {
          //  抓取各個input的值
          let name = $('#firstName').val();
          let id = $('#IDCARD').val();
          let birthday = $('#Birthday').val();
          let gender = $('#gender').val();
          let password = $('#password').val();
          let email = $('#email').val();
          let phone = $('#phone').val();
          let city = $('select[name="city"]').val();
          let cityarea = $('select[name="cityarea"]').val();
          let street = city + cityarea + $('#street').val();


          // ajax傳到後端
          $.ajax({
            method: 'post',
            url: '../../Register',
            data: {
              'firstname': name,
              'IDCARD': id,
              'Birthday': birthday,
              'gender': gender,
              'password': password,
              'email': email,
              'phone': phone,
              'street': street,
            },
            success: function (res) {
              if (res === 'true') {
                swal({ title: "註冊成功", icon: "success" })
                  .then(function (ok) {
                    if (ok) {
                      window.location.replace("../../index");
                    }
                  })
              } else if ((resp === 'false')) {
                swal({ title: "註冊失敗", icon: "error" });
              }
            }
          })
        } else {
          swal({ title: "請輸入完整資料!", icon: "error" });
        }

      })

      // 欄位不可為空
      $('.form-control').blur(function (e) {
        // console.log($(this).attr('id'));
        // const target = e.target;
        const val = $(this).val();
        const id = $(this).attr('id');
        if ($.trim(val)) {              //首先判斷是否為空值
          $(this).attr('class', 'form-control ok')

          if (id === 'password') {
            passlength($(this));
          } else if (id === 'email') {
            emailRule($(this));
          } else if (id === 'IDCARD' && !verifyId(val)) {
            $(this).attr({
              'placeholder': '請填寫正確身分證字號',
              'class': 'form-control err'
            }).val(null);
          } else if (id === 'firstName') {
            name1($(this));
          } else if (id === 'ConfirmPassword') {
            Confirm($('#password').val(), $(this));
          } else if (id === 'phone') {
            phonectrl($(this));
          } else if (id === 'Birthday') {
            age($(this))
          }
        } else {
          $(this).val(null).attr({
            'placeholder': '欄位不可為空',
            'class': 'form-control err'
          })
        }
      })
      $('#gender').change(function () {
        $('.grndert').remove();
        $(this).addClass('ok')
      })

      // 判斷email為正確格式 (正規表達式)
      function emailRule(object) {
        Rule = /^\w+((-\w+)|(\.\w+))*\@[A-Za-z0-9]+((\.|-)[A-Za-z0-9]+)*\.[A-Za-z]+$/;
        if (object.val().search(Rule) === -1) {
          object.attr({
            'placeholder': '請填寫正確E-MAIL',
            'class': 'form-control err'
          }).val(null)
        } else {
          $.ajax({
            url: "../../Register?cheak=cheak",
            method: "post",
            dataType: "text",
            data: {
              email: object.val()
            },
            success: function (res) {
              if (res == 'true') {
                object.attr({
                  'placeholder': '已重複的E-MAIL',
                  'class': 'form-control err'
                }).val(null)
              }
              console.log(res)
            }
          })
        }
      }
      // 判斷密碼為6-12碼
      function passlength(object) {
        if (object.val().length < 6 || object.val().length > 12) {
          object.attr({
            'placeholder': '密碼長度請填寫6～12',
            'class': 'form-control err'
          }).val(null)
        }
      }
      //身分證字號判斷  (正規表達式)
      function verifyId(id) {
        id = id.trim();
        verification = id.match("^[A-Z][12]\\d{8}$")
        if (!verification) {
          return false
        }
        let conver = "ABCDEFGHJKLMNPQRSTUVXYWZIO"
        let weights = [1, 9, 8, 7, 6, 5, 4, 3, 2, 1, 1]
        id = String(conver.indexOf(id[0]) + 10) + id.slice(1);
        checkSum = 0
        for (let i = 0; i < id.length; i++) {
          c = parseInt(id[i])
          w = weights[i]
          checkSum += c * w
        }
        return checkSum % 10 == 0
      }
      // 判斷姓名為中文
      function name1(object) {
        const pattern = /^[\u4E00-\u9FA5]{1,6}$/;
        if (object.val().search(pattern) === -1) {
          object.attr({
            'placeholder': '請填寫正確姓名格式',
            'class': 'form-control err'
          }).val(null)

        }
      }
      //判斷再次確認密碼是否正確
      function Confirm(password, ConfirmPassword) {
        if (!(password === ConfirmPassword.val())) {
          ConfirmPassword.attr({
            'placeholder': '請確認密碼是否一致',
            'class': 'form-control err'
          }).val(null)
        }
      }
      //判斷電話是否09開頭
      function phonectrl(object) {
        const pattern = /^09[0-9]{8}$/;
        if (object.val().search(pattern) === -1) {
          object.attr({
            'placeholder': '請填寫正確手機號碼',
            'class': 'form-control err'
          }).val(null)
        }
      }

      // 生日小於20歲不給註冊
      function age(object) {
        let now = new Date().getFullYear();  //現在日期
        let birthday = new Date($("#Birthday").val()).getFullYear(); //選擇的日期
        if ((now - birthday) < 20) {
          swal({ title: "註冊年齡須滿20歲!", icon: "error" });
          object.attr({
            'class': 'form-control err'
          }).val(null)
        }
      }

    </script>
</body>

</html>